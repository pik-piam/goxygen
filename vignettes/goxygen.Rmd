---
title: "Writing in-source documentation for GAMS code with goxygen"
author: "David Klein, Jan Philipp Dietrich"
date: "17.06.2020"
output: rmarkdown::html_vignette
bibliography: bibliography.bib
vignette: >
  %\VignetteIndexEntry{goxygen}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Purpose and Functionality

Goxygen provides tools to extract a model documentation from GAMS code, including comments, code, and even GAMS equations, the latter of which are converted into latex code. This allows having GAMS code and explanatory text side by side in the same gms files, which makes it easier to keep the comments up to date with the code. The goxygen output is returned in HTML, Markdown, and PDF format. In this vignette we will focus on the HTML output.

In order to use the package you need to install pandoc and pandoc-citeproc first (https://pandoc.org/).

Goxygen can extract the documentation from plain GAMS code (see next section) or from GAMS models that have a modularized structure as described in @dietrich_magpie4 (see further down).

## Running goxygen on plain GAMS code

We take the GAMS code example from this package and save it to `tmp-plain.gms`:

```{r}
# create temporary folder for the plain GAMS model
dir.create("tmp-plain")
# copy the folder containing a simple dummy model with goxygen comments 
file.copy(from = system.file("dummymodel-plain",package="goxygen"), to = "tmp-plain", recursive = TRUE)
```

and execute `goxygen` on this GAMS file to produce the documentation in html format. If you want the documentation in pdf format simply set `output = "pdf"`.

```{r}
library(goxygen)
goxygen(path = "tmp-plain", mainfile = "main.gms", output = "html")
```

Goxygen now searches the code for all lines starting with the goxygen tag "*'", interpretes the goxygen identifiers, and compiles the documentation into the format specified (html, tex, pdf). Please find the goxygen output in the folder `tmp-plain/doc`.

The short example GAMS file contains all identifiers available in goxygen. The resulting document starts with a table of contents.

* `@title` Adds the heading with the title to the documentation.

* `@description` Contains the text describing the model. Start a new paragraph by adding a blank line that starts with `*'`.

* `@authors` List the authors of the model here.

* `@limitations` Explain the limitation of the model.

* `@code` All following lines of the model code will be displayed in the documentation output as code blocks. Lines starting with `*'` will be displayed as regular text.

* `@equations` starts the equation section where goxygen converts GAMS equations into LaTeX code so that they are displayed nicely in the output.

* `@stop` Everything following will be ignored until the next identifier is mentioned again. In this case the following code is not included in the documentation output:

    ```
    *' Even goxygen comments are ignored.
    display v01_intern.l;
    ```
    until the `@code` tag resumes the documentation.
    

## Running goxygen on modularized GAMS code

This was a simple example of a GAMS model in a single file with a plain structure. As soon as model and code get more complex it is helpful to structure the model in a modular way as described by @dietrich_magpie4. Goxygen is tailored to extract the documentation from this modular structure and compile it to a clearly arranged documentation. Goxygen identifies modules and their interfaces, generates an interface plot that depicts the interactions between modules, and lists the inputs and outputs of modules. For each module goxygen creates a new chapter in the documentation. We will demonstrate this using the simple example model from the `gms` package:

```{r}
# create a temporary folder for the modularized GAMS model
dir.create("tmp-modular")
# copy all files and folders containing the modular dummy model
file.copy(from = system.file("dummymodel",package="gms"), to = "tmp-modular", recursive = TRUE)
```

Now execute `goxygen` on the modular GAMS model:

```{r}
goxygen(path = "tmp-modular/dummymodel", output = "html")
```

Please find the goxygen output in the folder `tmp-modular/dummymodel/doc`.
 
## References
